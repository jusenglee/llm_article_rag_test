<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>RAG Query Web</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', Pretendard, sans-serif; background: #f6f8fa; color: #222; margin: 0;
      display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
    h2 { margin-top: 60px; color: #1e88e5; font-weight: 700; }
    form { background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.08); border-radius: 12px; padding: 20px;
      width: 90%; max-width: 700px; display: flex; flex-direction: column; gap: 12px; margin-top: 20px; }
    textarea { resize: none; font-size: 16px; line-height: 1.5; padding: 12px; border-radius: 8px;
      border: 1px solid #ccc; transition: 0.2s; }
    textarea:focus { border-color: #1e88e5; box-shadow: 0 0 0 3px rgba(30,136,229,0.2); }
    button { align-self: flex-end; background: #1e88e5; color: #fff; border: none; border-radius: 8px;
      font-size: 16px; padding: 10px 20px; cursor: pointer; transition: 0.2s; }
    button:hover { background: #1565c0; }
    #result { width: 90%; max-width: 700px; background: #fff; margin-top: 25px; padding: 20px;
      border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.08); line-height: 1.7; }
    #logs { background: #f1f1f1; border-radius: 8px; padding: 12px; font-family: monospace;
      font-size: 14px; margin-top: 16px; white-space: pre-wrap; color: #333; }
    .loading { text-align: center; font-size: 18px; color: #666; animation: blink 1.2s infinite; }
    @keyframes blink { 0%{opacity:0.3;} 50%{opacity:1;} 100%{opacity:0.3;} }
  </style>
</head>
<body>
<h2>ğŸ” ì—°êµ¬ ë…¼ë¬¸ ì§ˆì˜ì‘ë‹µ</h2>
<form id="qform">
  <textarea name="question" id="question" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." rows="3"></textarea>
  <button type="submit">ì§ˆì˜</button>
</form>
<div id="result"></div>

<script>
  const form = document.getElementById("qform");
  const resultDiv = document.getElementById("result");

  form.onsubmit = async (e) => {
    e.preventDefault();
    const q = document.getElementById("question").value.trim();
    if (!q) return;
    resultDiv.innerHTML = "<div class='loading'>â³ ì§ˆì˜ ì¤‘...</div>";

    try {
      const res = await fetch("/query", {
        method: "POST",
        body: new URLSearchParams({ question: q }),
        headers: { "Content-Type": "application/x-www-form-urlencoded" }
      });
      const data = await res.json();

      let html = `<h3>ğŸ§  ${data.mode === 'rag' ? 'RAG ì‘ë‹µ' : 'ì¼ë°˜ ëŒ€í™”'}</h3>`;
      html += marked.parse(data.answer || "ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤.");

      if (data.refs) {
        html += `<hr><b>ì°¸ê³ ë¬¸í—Œ</b><ul>${data.refs.map(r => `<li>${r[1]} (${r[2]})</li>`).join('')}</ul>`;
      }

      if (data.logs && data.logs.length) {
        html += `<div id="logs"><b>ì„œë²„ ë¡œê·¸</b>\n${data.logs.join("\n")}</div>`;
      }

      resultDiv.innerHTML = html;
    } catch (err) {
      resultDiv.innerHTML = "<p style='color:red;'>âš ï¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.</p>";
      console.error(err);
    }
  };
</script>
</body>
</html>
